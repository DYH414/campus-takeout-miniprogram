<view class="container">
  <!-- 搜索栏 -->
  <view class="search-bar">
    <input type="text" placeholder="搜索商家" bindinput="onSearch" />
  </view>

  <!-- 分类标签 -->
  <view class="category-section">
    <scroll-view class="category-list" scroll-x="true" enhanced="true" show-scrollbar="false">
      <view class="category-item {{currentCategory === item.name ? 'active' : ''}}" 
            wx:for="{{categories}}" 
            wx:key="id"
            bindtap="switchCategory" 
            data-category="{{item.name}}">
        <image class="category-icon" 
               src="{{item.icon}}" 
               mode="aspectFit"
               binderror="onImageError"
               data-index="{{index}}"
        ></image>
        <text class="category-name">{{item.name}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- 平台选择器 -->
  <view class="platform-selector" wx:if="{{showPlatformSelector}}">
    <view class="platform-selector-mask" bindtap="closePlatformSelector"></view>
    <view class="platform-selector-content">
      <view class="platform-selector-title">选择下单平台</view>
      <view class="platform-list">
        <view class="platform-item" 
              wx:for="{{currentShop.platforms}}" 
              wx:key="type"
              bindtap="navigateToPlatform" 
              data-platform="{{item}}">
          <image class="platform-icon" src="{{item.icon}}" mode="aspectFit"></image>
          <text class="platform-name">{{item.name}}</text>
        </view>
      </view>
      <view class="platform-selector-close" bindtap="closePlatformSelector">取消</view>
    </view>
  </view>

  <!-- 商家列表优化 -->
  <view class="shop-list">
    <view wx:for="{{shopList}}" wx:key="_id" class="shop-item" bindtap="navigateToShop" data-shop="{{item}}">
      <!-- 商家信息部分 -->
      <view class="shop-main">
        <image src="{{item.logoUrl}}" class="shop-image" lazy-load="true" mode="aspectFill" binderror="handleLogoError" data-index="{{index}}"></image>
        <view class="shop-info">
          <text class="shop-name">{{item.name}}</text>
          <view class="shop-rating" wx:if="{{item.avgRating}}">
            <text class="rating-text">{{item.avgRating}}</text>
            <text class="rating-count">({{item.ratingCount || 0}}人评)</text>
          </view>
          <view class="shop-address" wx:if="{{item.address}}">{{item.address}}</view>
        </view>
      </view>
      
      <!-- 热门评论部分 -->
      <view class="hot-comment" wx:if="{{item.hotComment}}" catchtap="goToShopDetail" data-id="{{item._id}}">
        <view class="hot-comment-title">
          <image class="hot-icon" src="/static/images/hot.png" mode="aspectFit"></image>
          <text>热门评价</text>
        </view>
        <view class="hot-comment-content">
          <image class="avatar" src="{{item.hotComment.userInfo.avatarUrl}}" mode="aspectFill"></image>
          <view class="comment-right">
            <view class="comment-top">
              <text class="nickname">{{item.hotComment.userInfo.nickName}}</text>
              <view class="like-count">
                <text class="like-count-num">{{item.hotComment.likeCount}}</text>
                <text class="like-icon">♥</text>
              </view>
            </view>
            <view class="content">{{item.hotComment.content.length > 30 ? item.hotComment.content.slice(0, 30) + '...' : item.hotComment.content}}</view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 加载状态提示 -->
    <view class="loading-more" wx:if="{{shopList.length === 0}}">
      <view class="loading-spinner"></view>
      <text>加载中...</text>
    </view>
  </view>
</view> 