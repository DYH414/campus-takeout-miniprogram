<view class="container">
  <!-- 搜索栏 -->
  <view class="search-bar">
    <input type="text" placeholder="搜索商家" bindinput="onSearch" />
  </view>

  <!-- 分类标签 -->
  <view class="category-section">
    <scroll-view class="category-list" scroll-x="true" enhanced="true" show-scrollbar="false">
      <view class="category-item {{currentCategory === item.name ? 'active' : ''}}" 
            wx:for="{{categories}}" 
            wx:key="id"
            bindtap="switchCategory" 
            data-category="{{item.name}}">
        <image class="category-icon" 
               src="{{item.icon}}" 
               mode="aspectFit"
               binderror="onImageError"
               data-index="{{index}}"
        ></image>
        <text class="category-name">{{item.name}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- 平台选择器 -->
  <view class="platform-selector" wx:if="{{showPlatformSelector}}">
    <view class="platform-selector-mask" bindtap="closePlatformSelector"></view>
    <view class="platform-selector-content">
      <view class="platform-selector-title">选择下单平台</view>
      <view class="platform-list">
        <view class="platform-item" 
              wx:for="{{currentShop.platforms}}" 
              wx:key="type"
              bindtap="navigateToPlatform" 
              data-platform="{{item}}">
          <image class="platform-icon" src="{{item.icon}}" mode="aspectFit"></image>
          <text class="platform-name">{{item.name}}</text>
        </view>
      </view>
      <view class="platform-selector-close" bindtap="closePlatformSelector">取消</view>
    </view>
  </view>

  <!-- 商家列表 -->
  <scroll-view class="shop-list" scroll-y="true" bindscrolltolower="loadMore">
    <view class="shop-card" wx:for="{{shopList}}" wx:key="_id">
      <!-- 商家信息 -->
      <view class="shop-info" bindtap="navigateToShop" data-shop="{{item}}">
        <image class="shop-logo" src="{{item.logoUrl}}" mode="aspectFill" binderror="handleLogoError" data-index="{{index}}"></image>
        <view class="shop-detail">
          <view class="shop-name">{{item.name}}</view>
          <!-- 添加星级评分 -->
          <view class="rating-stars" catchtap="noop">
            <view class="stars-container">
              <view class="stars-bg">
                <text class="icon-star" wx:for="{{[1,2,3,4,5]}}" wx:key="*this" wx:for-item="star" catchtap="rateShop" data-shop-id="{{item._id}}" data-rating="{{star}}">☆</text>
              </view>
              <view class="stars-active" style="width: {{item.avgRating ? (item.avgRating/5)*100 : 0}}%">
                <text class="icon-star" wx:for="{{[1,2,3,4,5]}}" wx:key="*this" wx:for-item="star">★</text>
              </view>
            </view>
            <text class="rating-score" wx:if="{{item.avgRating}}">{{item.avgRating}}</text>
          </view>
        </view>
      </view>
      
      <!-- 热门评论 -->
      <view class="hot-comment" wx:if="{{item.hotComment}}" bindtap="goToShopDetail" data-id="{{item._id}}">
        <view class="hot-comment-title">
          <image class="hot-icon" src="/static/images/hot.png" mode="aspectFit"></image>
          <text>热门评价</text>
        </view>
        <view class="hot-comment-content">
          <image class="avatar" src="{{item.hotComment.userInfo.avatarUrl}}" mode="aspectFill"></image>
          <view class="comment-right">
            <view class="comment-top">
              <text class="nickname">{{item.hotComment.userInfo.nickName}}</text>
              <view class="like-count">
                <text class="like-count-num">{{item.hotComment.likeCount}}</text>
                <text class="like-icon">♥</text>
              </view>
            </view>
            <view class="content">{{item.hotComment.content.length > 30 ? item.hotComment.content.slice(0, 30) + '...' : item.hotComment.content}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="loading" wx:if="{{isLoading}}">加载中...</view>
    <view class="no-more" wx:if="{{noMore}}">没有更多了</view>
  </scroll-view>
</view> 